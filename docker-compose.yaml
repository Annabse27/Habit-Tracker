services:
     db:
       image: postgres
       restart: always
       environment:
         - POSTGRES_DB=${POSTGRES_DB}
         - POSTGRES_USER=${POSTGRES_USER}
         - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

       ports:
         - "5432:5432"
       volumes:
         - pg_data:/var/lib/postgresql/data
       healthcheck:
         test: ["CMD-SHELL", "pg_isready -U $POSTGRES_USER"]
         interval: 10s
         timeout: 5s
         retries: 5

     redis:
       image: redis:latest
       restart: always
       ports:
         - "6379:6379"

     app:
       depends_on:
         db:
           condition: service_healthy
         redis:
           condition: service_started
       build:
         context: .
       command: ./wait-for-it.sh db:5432 -- python manage.py runserver 0.0.0.0:8000

       #command: sh -c "python manage.py migrate && python manage.py runserver 0.0.0.0:8000"
       volumes:
         - .:/app
         - ./logs:/app/logs  # Логи приложения

       ports:
         - "8000:8000"
       env_file:
         - .env

     celery:
       build: .
       command: celery -A config worker --loglevel=INFO
       depends_on:
         - redis
         - db
       env_file:
         - .env

     celery-beat:
       build: .
       command: celery -A config beat --loglevel=INFO
       depends_on:
         - redis
         - db
       env_file:
         - .env


volumes:
  pg_data:  # Том для хранения данных PostgreSQL
  logs:     # Том для хранения логов приложения









